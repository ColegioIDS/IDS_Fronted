# ğŸ—ï¸ Arquitectura de la IntegraciÃ³n: Bimester/Cycles

## ğŸ“Š Diagrama de Arquitectura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (Next.js 15)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PRESENTATION LAYER                          â”‚
â”‚                          (Components UI)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ CycleSelector     â”‚  â”‚   CycleInfo       â”‚  â”‚ BimesterForm     â”‚â”‚
â”‚  â”‚ (Dropdown)        â”‚  â”‚   (Info Card)     â”‚  â”‚ (Ejemplo)        â”‚â”‚
â”‚  â”‚                   â”‚  â”‚                   â”‚  â”‚                  â”‚â”‚
â”‚  â”‚ - Auto-select     â”‚  â”‚ - Muestra datos   â”‚  â”‚ - ValidaciÃ³n     â”‚â”‚
â”‚  â”‚ - Loading states  â”‚  â”‚ - Bimestres       â”‚  â”‚ - Create/Update  â”‚â”‚
â”‚  â”‚ - Dark mode       â”‚  â”‚ - Stats           â”‚  â”‚ - Error handling â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚            â”‚                      â”‚                       â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                      â”‚                       â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          BUSINESS LOGIC LAYER                        â”‚
â”‚                          (Custom Hooks)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                   â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              useBimesterCycles()                                â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  - cycles (SchoolCycleForBimester[])                           â”‚ â”‚
â”‚  â”‚  - activeCycle (SchoolCycleForBimester | null)                 â”‚ â”‚
â”‚  â”‚  - isLoading, error, meta                                      â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  MÃ©todos:                                                       â”‚ â”‚
â”‚  â”‚  - loadActiveCycle()                                           â”‚ â”‚
â”‚  â”‚  - loadAvailableCycles()                                       â”‚ â”‚
â”‚  â”‚  - getCycleDetails(id)                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              useBimesters()                                     â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  - data (Bimester[])                                           â”‚ â”‚
â”‚  â”‚  - meta (pagination)                                           â”‚ â”‚
â”‚  â”‚  - isLoading, error, query                                     â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  MÃ©todos:                                                       â”‚ â”‚
â”‚  â”‚  - updateQuery()                                               â”‚ â”‚
â”‚  â”‚  - setPage()                                                   â”‚ â”‚
â”‚  â”‚  - refresh()                                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DATA ACCESS LAYER                            â”‚
â”‚                          (Services)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                    â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              bimesterService                                     â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  BIMESTER CRUD:                                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ getAll(query)      â†’ GET /api/bimesters                   â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ getById(id)        â†’ GET /api/bimesters/:id               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ create(cycleId, data) â†’ POST /school-cycles/:id/bimestersâ”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ update(id, data)   â†’ PATCH /api/bimesters/:id             â”‚ â”‚
â”‚  â”‚  â””â”€â”€ delete(id)         â†’ DELETE /api/bimesters/:id            â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  ğŸ†• CYCLES (para permisos de bimester):                         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ getActiveCycle()   â†’ GET /api/bimesters/cycles/active     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ getAvailableCycles() â†’ GET /api/bimesters/cycles/availableâ”‚ â”‚
â”‚  â”‚  â””â”€â”€ getCycleById(id)   â†’ GET /api/bimesters/cycles/:id        â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  UTILS:                                                          â”‚ â”‚
â”‚  â”‚  â””â”€â”€ validateBimesterDates()                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          HTTP CLIENT LAYER                            â”‚
â”‚                          (Axios Config)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                api (Axios Instance)                              â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  Config:                                                         â”‚ â”‚
â”‚  â”‚  - baseURL: process.env.NEXT_PUBLIC_API_URL                    â”‚ â”‚
â”‚  â”‚  - withCredentials: true                                        â”‚ â”‚
â”‚  â”‚  - validateStatus: () => true  âš ï¸ CRÃTICO                      â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  Interceptors:                                                   â”‚ â”‚
â”‚  â”‚  - Request: Agrega JWT token                                    â”‚ â”‚
â”‚  â”‚  - Response: Maneja errores globales                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BACKEND (NestJS)                             â”‚
â”‚                         API Endpoints                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  ğŸ†• Bimester Cycles Module                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ GET  /api/bimesters/cycles/active                           â”‚   â”‚
â”‚  â”‚ GET  /api/bimesters/cycles/available                        â”‚   â”‚
â”‚  â”‚ GET  /api/bimesters/cycles/:id                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  Bimesters Module                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ GET    /api/bimesters                                        â”‚   â”‚
â”‚  â”‚ GET    /api/bimesters/:id                                    â”‚   â”‚
â”‚  â”‚ POST   /api/school-cycles/:cycleId/bimesters                 â”‚   â”‚
â”‚  â”‚ PATCH  /api/bimesters/:id                                    â”‚   â”‚
â”‚  â”‚ DELETE /api/bimesters/:id                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  Authorization:                                                       â”‚
â”‚  - JWT Token en cookie HTTP-only                                     â”‚
â”‚  - Permisos: bimester:read, bimester:create, etc.                   â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de Datos Completo

### Ejemplo: Usuario crea un bimestre

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario  â”‚ Abre formulario de crear bimestre
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BimesterFormExample    â”‚ Renderiza
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â–º Usa: useBimesterCycles()
     â”‚   â””â”€â–º Llama: loadAvailableCycles()
     â”‚       â””â”€â–º Service: getAvailableCycles()
     â”‚           â””â”€â–º API: GET /api/bimesters/cycles/available
     â”‚               â””â”€â–º Backend: Valida bimester:read
     â”‚                   â””â”€â–º DB: SELECT * FROM schoolCycles WHERE isArchived = false
     â”‚                       â””â”€â–º Response: { data: [...cycles], meta: {...} }
     â”‚
     â”œâ”€â–º Renderiza: CycleSelector
     â”‚   â””â”€â–º Muestra: Lista de ciclos NO archivados
     â”‚       â””â”€â–º Auto-selecciona: Ciclo activo (isActive = true)
     â”‚
     â”œâ”€â–º Renderiza: CycleInfo (si hay ciclo seleccionado)
     â”‚   â””â”€â–º Llama: getCycleDetails(cycleId)
     â”‚       â””â”€â–º API: GET /api/bimesters/cycles/:id
     â”‚           â””â”€â–º Response: { cycle con bimestres y stats }
     â”‚
     â”‚ Usuario llena formulario y hace submit
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleSubmit           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â–º ValidaciÃ³n: Zod schema
     â”‚   â””â”€â–º Si error: Muestra mensajes
     â”‚
     â”œâ”€â–º ValidaciÃ³n: validateBimesterDates()
     â”‚   â””â”€â–º Verifica fechas contra ciclo
     â”‚
     â”œâ”€â–º Service: bimesterService.create(cycleId, data)
     â”‚   â””â”€â–º API: POST /api/school-cycles/:cycleId/bimesters
     â”‚       â””â”€â–º Backend: Valida bimester:create
     â”‚           â””â”€â–º DB: INSERT INTO bimesters (...)
     â”‚               â””â”€â–º Response: { success: true, data: newBimester }
     â”‚
     â”œâ”€â–º Si Ã©xito:
     â”‚   â”œâ”€â–º handleApiSuccess('Bimestre creado')
     â”‚   â”‚   â””â”€â–º Toast de Ã©xito
     â”‚   â”œâ”€â–º onSuccess() callback
     â”‚   â””â”€â–º Cierra dialog
     â”‚
     â””â”€â–º Si error:
         â”œâ”€â–º handleApiError(err)
         â”‚   â””â”€â–º Toast de error con detalles
         â””â”€â–º Muestra ErrorAlert
```

---

## ğŸ—‚ï¸ Capas de la Arquitectura

### 1ï¸âƒ£ Presentation Layer (UI)
```
Responsabilidad: Renderizar UI + Capturar eventos

Componentes:
- CycleSelector     â†’ Dropdown de ciclos
- CycleInfo         â†’ Card informativa
- BimesterForm      â†’ Formulario completo

CaracterÃ­sticas:
âœ… React components
âœ… Dark mode
âœ… Responsive
âœ… Loading states
âœ… Error states
```

### 2ï¸âƒ£ Business Logic Layer (Hooks)
```
Responsabilidad: LÃ³gica de negocio + Estado

Hooks:
- useBimesterCycles â†’ Gestiona ciclos
- useBimesters      â†’ Gestiona bimestres

CaracterÃ­sticas:
âœ… Custom hooks
âœ… Estado local
âœ… Side effects (useEffect)
âœ… MemoizaciÃ³n (useCallback)
```

### 3ï¸âƒ£ Data Access Layer (Services)
```
Responsabilidad: ComunicaciÃ³n con API

Services:
- bimesterService   â†’ LÃ³gica de API

CaracterÃ­sticas:
âœ… Axios calls
âœ… ValidaciÃ³n de responses
âœ… Error handling
âœ… TypeScript strict
```

### 4ï¸âƒ£ HTTP Client Layer (Config)
```
Responsabilidad: ConfiguraciÃ³n HTTP

Config:
- api (axios instance)

CaracterÃ­sticas:
âœ… Base URL
âœ… Interceptors
âœ… JWT token
âœ… validateStatus: () => true
```

### 5ï¸âƒ£ Backend Layer (NestJS)
```
Responsabilidad: Endpoints + DB

Endpoints:
- /api/bimesters/cycles/active
- /api/bimesters/cycles/available
- /api/bimesters/cycles/:id
- /api/bimesters (CRUD)

CaracterÃ­sticas:
âœ… JWT validation
âœ… Permission checks
âœ… Prisma ORM
âœ… PostgreSQL
```

---

## ğŸ” Flujo de Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario  â”‚ Hace request
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ api.interceptor    â”‚ Agrega JWT token del localStorage
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: Guard     â”‚ Valida JWT
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â–º âœ… Token vÃ¡lido
     â”‚   â””â”€â–º Extrae userId del token
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Permission Check   â”‚ Verifica bimester:read
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â–º âœ… Tiene permiso
     â”‚   â””â”€â–º ContinÃºa a controller
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controller         â”‚ Ejecuta lÃ³gica
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service            â”‚ Consulta DB
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response           â”‚ { success: true, data: {...} }
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ SeparaciÃ³n de Responsabilidades

| Capa | Responsabilidad | No Debe |
|------|----------------|---------|
| **Components** | UI + Eventos | âŒ Llamar API directamente |
| **Hooks** | Estado + LÃ³gica | âŒ Renderizar JSX |
| **Services** | API calls | âŒ Manejar estado React |
| **Utils** | Helpers | âŒ Tener side effects |
| **Types** | Definiciones | âŒ Tener lÃ³gica |

---

## ğŸ¯ Principios Aplicados

### 1. Separation of Concerns
```
UI â† Hooks â† Services â† API â† Backend
Cada capa tiene una responsabilidad Ãºnica
```

### 2. Single Source of Truth
```
useBimesterCycles â†’ Ãšnica fuente de datos de ciclos
No duplicar estado
```

### 3. Error Handling Centralizado
```
handleApiError() â†’ Maneja TODOS los errores
Toast automÃ¡tico + Log + Return details
```

### 4. Type Safety
```
TypeScript strict mode
No 'any' innecesarios
Interfaces bien definidas
```

### 5. Reusability
```
CycleSelector â†’ Reutilizable en cualquier formulario
CycleInfo â†’ Reutilizable en cualquier vista
```

---

## ğŸ”„ PatrÃ³n de Estado

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Component (BimesterForm)       â”‚
â”‚                                     â”‚
â”‚  const { cycles, activeCycle,      â”‚
â”‚          isLoading, error           â”‚
â”‚        } = useBimesterCycles();     â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ if (isLoading) return <Skeleton>â”‚
â”‚  â”‚ if (error) return <Alert>      â”‚ â”‚
â”‚  â”‚ if (!cycles.length) return <Empty>â”‚
â”‚  â”‚ return <CycleSelector />       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Hook (useBimesterCycles)          â”‚
â”‚                                     â”‚
â”‚  useState:                          â”‚
â”‚  - cycles                           â”‚
â”‚  - activeCycle                      â”‚
â”‚  - isLoading                        â”‚
â”‚  - error                            â”‚
â”‚                                     â”‚
â”‚  useEffect:                         â”‚
â”‚  - loadAvailableCycles()            â”‚
â”‚                                     â”‚
â”‚  useCallback:                       â”‚
â”‚  - refresh()                        â”‚
â”‚  - getCycleDetails()                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Service (bimesterService)         â”‚
â”‚                                     â”‚
â”‚  getAvailableCycles():              â”‚
â”‚  1. Construye query params          â”‚
â”‚  2. Llama API                       â”‚
â”‚  3. Valida response.data.success    â”‚
â”‚  4. Retorna { data, meta }          â”‚
â”‚  5. O lanza error                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“– Referencias

- **Master Guide:** `master_guide_general_v2.md`
- **IntegraciÃ³n:** `INTEGRATION_BIMESTER_CYCLES.md`
- **Quick Start:** `QUICK_START_BIMESTER_CYCLES.md`

---

**Ãšltima actualizaciÃ³n:** 2025-01-29  
**VersiÃ³n:** 1.0
